{"version":3,"sources":["../../src/lib/connectAnnotationToLayout.js"],"names":["connectAnnotationToLayout","WrappedComponent","AnnotationConnectedComponent","props","context","deleteAnnotation","bind","updateAnnotation","setLocals","nextProps","nextContext","annotationIndex","container","fullContainer","annotations","fullAnnotations","getValObject","attr","updateContainer","deleteContainer","update","newUpdate","key","newkey","onUpdate","type","EDITOR_ACTIONS","DELETE_ANNOTATION","payload","Component","displayName","propTypes","PropTypes","number","isRequired","contextTypes","object","data","array","func","childContextTypes","plotly_editor_traits"],"mappings":"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","file":"connectAnnotationToLayout.js","sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {getDisplayName} from '../lib';\nimport {EDITOR_ACTIONS} from './constants';\n\nexport default function connectAnnotationToLayout(WrappedComponent) {\n  class AnnotationConnectedComponent extends Component {\n    constructor(props, context) {\n      super(props, context);\n\n      this.deleteAnnotation = this.deleteAnnotation.bind(this);\n      this.updateAnnotation = this.updateAnnotation.bind(this);\n      this.setLocals(props, context);\n    }\n\n    componentWillReceiveProps(nextProps, nextContext) {\n      this.setLocals(nextProps, nextContext);\n    }\n\n    setLocals(props, context) {\n      const {annotationIndex} = props;\n      const {container, fullContainer} = context;\n\n      const annotations = container.annotations || [];\n      const fullAnnotations = fullContainer.annotations || [];\n      this.container = annotations[annotationIndex];\n      this.fullContainer = fullAnnotations[annotationIndex];\n    }\n\n    getChildContext() {\n      return {\n        getValObject: attr =>\n          !this.context.getValObject ? null : this.context.getValObject(`annotations[].${attr}`),\n        updateContainer: this.updateAnnotation,\n        deleteContainer: this.deleteAnnotation,\n        container: this.container,\n        fullContainer: this.fullContainer,\n      };\n    }\n\n    provideValue() {\n      return {\n        getValObject: attr =>\n          !this.context.getValObject ? null : this.context.getValObject(`annotations[].${attr}`),\n        updateContainer: this.updateAnnotation,\n        deleteContainer: this.deleteAnnotation,\n        container: this.container,\n        fullContainer: this.fullContainer,\n      };\n    }\n\n    updateAnnotation(update) {\n      const newUpdate = {};\n      const {annotationIndex} = this.props;\n      for (const key in update) {\n        const newkey = `annotations[${annotationIndex}].${key}`;\n        newUpdate[newkey] = update[key];\n      }\n      this.context.updateContainer(newUpdate);\n    }\n\n    deleteAnnotation() {\n      if (this.context.onUpdate) {\n        this.context.onUpdate({\n          type: EDITOR_ACTIONS.DELETE_ANNOTATION,\n          payload: {annotationIndex: this.props.annotationIndex},\n        });\n      }\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  }\n\n  AnnotationConnectedComponent.displayName = `AnnotationConnected${getDisplayName(\n    WrappedComponent\n  )}`;\n\n  AnnotationConnectedComponent.propTypes = {\n    annotationIndex: PropTypes.number.isRequired,\n  };\n\n  AnnotationConnectedComponent.contextTypes = {\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    data: PropTypes.array,\n    onUpdate: PropTypes.func,\n    updateContainer: PropTypes.func,\n    getValObject: PropTypes.func,\n  };\n\n  AnnotationConnectedComponent.childContextTypes = {\n    updateContainer: PropTypes.func,\n    deleteContainer: PropTypes.func,\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    getValObject: PropTypes.func,\n  };\n\n  const {plotly_editor_traits} = WrappedComponent;\n  AnnotationConnectedComponent.plotly_editor_traits = plotly_editor_traits;\n\n  return AnnotationConnectedComponent;\n}\n"]}