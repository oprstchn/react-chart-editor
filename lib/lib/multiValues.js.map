{"version":3,"sources":["../../src/lib/multiValues.js"],"names":["deepCopyPublic","value","skipPrivateKeys","key","startsWith","window","JSON","parse","stringify","setMultiValuedContainer","intoObj","fromObj","config","intoVal","fromVal","charAt","MULTI_VALUED","String","Array","isArray","searchArrays","i","length","Error","Object","keys","forEach","key2"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;;;;AAKA,SAASA,cAAT,CAAwBC,KAAxB,EAA+B;AAC7B,MAAI,OAAOA,KAAP,KAAiB,WAArB,EAAkC;AAChC,WAAOA,KAAP;AACD;;AAED,MAAMC,kBAAkB,SAAlBA,eAAkB,CAACC,GAAD,EAAMF,KAAN;AAAA,WAAiBE,IAAIC,UAAJ,CAAe,GAAf,IAAsB,CAAtB,GAA0BH,KAA3C;AAAA,GAAxB;;AAEA,SAAOI,OAAOC,IAAP,CAAYC,KAAZ,CAAkBF,OAAOC,IAAP,CAAYE,SAAZ,CAAsBP,KAAtB,EAA6BC,eAA7B,CAAlB,CAAP;AACD;;AAED;;;;AAIA,SAASO,uBAAT,CAAiCC,OAAjC,EAA0CC,OAA1C,EAAmDR,GAAnD,EAAqE;AAAA,MAAbS,MAAa,uEAAJ,EAAI;;AACnE,MAAMC,UAAUH,QAAQP,GAAR,CAAhB;AACA,MAAMW,UAAUH,QAAQR,GAAR,CAAhB;;AAEA;AACA,MACG,OAAOA,GAAP,KAAe,QAAf,IAA2BA,IAAIY,MAAJ,CAAW,CAAX,MAAkB,GAA7C,IAAoDZ,QAAQ,QAA7D,IACA,OAAOU,OAAP,KAAmB,UADnB,IAEAV,QAAQ,QAHV,EAIE;AACA;AACD;;AAED;AACA,MAAIU,YAAYG,uBAAhB,EAA8B;AAC5B;AACD,GAFD,MAEO,IAAIH,YAAY,KAAK,CAArB,EAAwB;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACAH,YAAQP,GAAR,IAAeW,OAAf;AACD,GATM,MASA,IAAIX,QAAQ,YAAZ,EAA0B;AAC/B;AACA;AACA;AACA,QAAIc,OAAOJ,OAAP,MAAoBI,OAAOH,OAAP,CAAxB,EAAyC;AACvCJ,cAAQP,GAAR,IAAea,uBAAf;AACD;AACF,GAPM,MAOA,IAAIE,MAAMC,OAAN,CAAcN,OAAd,CAAJ,EAA4B;AACjC;AACA;AACA,QAAI,CAACD,OAAOQ,YAAZ,EAA0B;AACxB;AACD;AACD,QAAI,CAACF,MAAMC,OAAN,CAAcL,OAAd,CAAL,EAA6B;AAC3BJ,cAAQP,GAAR,IAAea,uBAAf;AACD,KAFD,MAEO;AACL;AACA,WAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIP,QAAQQ,MAA5B,EAAoCD,GAApC,EAAyC;AACvCZ,gCAAwBI,OAAxB,EAAiCC,OAAjC,EAA0CO,CAA1C,EAA6CT,MAA7C;AACD;AACF;AACF,GAdM,MAcA,IAAI,wBAAcE,OAAd,CAAJ,EAA4B;AACjC;AACA,QAAI,CAAC,wBAAcD,OAAd,CAAL,EAA6B;AAC3B,YAAM,IAAIU,KAAJ,CAAU,4CAA4CpB,GAAtD,CAAN;AACD;AACDqB,WAAOC,IAAP,CAAYX,OAAZ,EAAqBY,OAArB,CAA6B,UAASC,IAAT,EAAe;AAC1ClB,8BAAwBI,OAAxB,EAAiCC,OAAjC,EAA0Ca,IAA1C,EAAgDf,MAAhD;AACD,KAFD;AAGD,GARM,MAQA,IAAI,wBAAcC,OAAd,CAAJ,EAA4B;AACjC,UAAM,IAAIU,KAAJ,CAAU,4CAA4CpB,GAAtD,CAAN;AACD,GAFM,MAEA,IAAIU,YAAYC,OAAhB,EAAyB;AAC9B;AACAJ,YAAQP,GAAR,IAAea,uBAAf;AACD;AACF;;QAEOhB,c,GAAAA,c;QAAgBS,uB,GAAAA,uB","file":"multiValues.js","sourcesContent":["import {MULTI_VALUED} from './constants';\nimport {isPlainObject} from '../lib';\n\n/**\n * Deep-copies the value using JSON. Underscored (private) keys are removed.\n * @param {*} value Some nested value from the plotDiv object.\n * @returns {*} A deepcopy of the value.\n */\nfunction deepCopyPublic(value) {\n  if (typeof value === 'undefined') {\n    return value;\n  }\n\n  const skipPrivateKeys = (key, value) => (key.startsWith('_') ? 0 : value);\n\n  return window.JSON.parse(window.JSON.stringify(value, skipPrivateKeys));\n}\n\n/*\n * WARNING: When using this function, make intoObj and fromObject are copies of\n * your objects, so that no mutations occur\n */\nfunction setMultiValuedContainer(intoObj, fromObj, key, config = {}) {\n  const intoVal = intoObj[key];\n  const fromVal = fromObj[key];\n\n  // don't merge private attrs\n  if (\n    (typeof key === 'string' && key.charAt(0) === '_' && key !== '_group') ||\n    typeof intoVal === 'function' ||\n    key === 'module'\n  ) {\n    return;\n  }\n\n  // already a mixture of values, can't get any worse\n  if (intoVal === MULTI_VALUED) {\n    return;\n  } else if (intoVal === void 0) {\n    // if the original doesn't have the key it's because that key\n    // doesn't do anything there - so use the new value\n    // note that if fromObj doesn't have a key in intoObj we will not\n    // attempt to merge them at all, so this behavior makes the merge\n    // independent of order.\n\n    // WARNING: Careful that data copies were passed in as args here, as mutation can occur\n    intoObj[key] = fromVal;\n  } else if (key === 'colorscale') {\n    // colorscales are arrays... need to stringify before comparing\n    // (other vals we don't want to stringify, as differences could\n    // potentially be real, like 'false' and false)\n    if (String(intoVal) !== String(fromVal)) {\n      intoObj[key] = MULTI_VALUED;\n    }\n  } else if (Array.isArray(intoVal)) {\n    // in data, other arrays are data, which we don't care about\n    // for styling purposes\n    if (!config.searchArrays) {\n      return;\n    }\n    if (!Array.isArray(fromVal)) {\n      intoObj[key] = MULTI_VALUED;\n    } else {\n      // in layout though, we need to recurse into arrays\n      for (let i = 0; i < fromVal.length; i++) {\n        setMultiValuedContainer(intoVal, fromVal, i, config);\n      }\n    }\n  } else if (isPlainObject(fromVal)) {\n    // recurse into objects\n    if (!isPlainObject(intoVal)) {\n      throw new Error('tried to merge object into non-object: ' + key);\n    }\n    Object.keys(fromVal).forEach(function(key2) {\n      setMultiValuedContainer(intoVal, fromVal, key2, config);\n    });\n  } else if (isPlainObject(intoVal)) {\n    throw new Error('tried to merge non-object into object: ' + key);\n  } else if (intoVal !== fromVal) {\n    // different non-empty values -\n    intoObj[key] = MULTI_VALUED;\n  }\n}\n\nexport {deepCopyPublic, setMultiValuedContainer};\n"]}