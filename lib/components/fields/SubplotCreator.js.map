{"version":3,"sources":["../../../src/components/fields/SubplotCreator.js"],"names":["UnconnectedSingleSubplotCreator","currentAxisId","props","fullContainer","attr","currentTraceIndex","index","context","fullData","some","d","layoutAttr","updateContainer","subplots","fullLayout","_subplots","lastSubplotNumber","Number","length","split","SUBPLOT_TO_ATTR","layout","update","currentSubplotId","data","subplotToBeGarbageCollected","trace","onUpdate","type","EDITOR_ACTIONS","UPDATE_TRACES","payload","traceIndexes","icon","extraComponent","canAddSubplot","addAndUpdateSubplot","label","options","updateSubplot","u","Component","propTypes","PropTypes","string","array","container","object","func","contextType","EditorControlsContext","SingleSubplotCreator","UnconnectedSubplotCreator","subplotType","t","isFirstTraceOfAxisType","filter","_","localize","getOptions","map","subplotId","value","setPanel","modifyPlotProps","plotProps","isVisible"],"mappings":"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","file":"SubplotCreator.js","sourcesContent":["import React, {Component} from 'react';\nimport Dropdown from './Dropdown';\nimport Info from './Info';\nimport PropTypes from 'prop-types';\nimport {EDITOR_ACTIONS, SUBPLOT_TO_ATTR} from 'lib/constants';\nimport Button from '../widgets/Button';\nimport {PlusIcon} from 'plotly-icons';\nimport {connectToContainer, traceTypeToAxisType, getSubplotTitle} from 'lib';\nimport {PlotlySection} from 'components';\nimport {EditorControlsContext, ModalProviderContext} from '../../context';\n\nclass UnconnectedSingleSubplotCreator extends Component {\n  canAddSubplot() {\n    const currentAxisId = this.props.fullContainer[this.props.attr];\n    const currentTraceIndex = this.props.fullContainer.index;\n    return this.context.fullData.some(\n      d => d.index !== currentTraceIndex && d[this.props.attr] === currentAxisId\n    );\n  }\n\n  addAndUpdateSubplot() {\n    const {attr, layoutAttr, updateContainer} = this.props;\n    const {\n      fullLayout: {_subplots: subplots},\n    } = this.context;\n    const lastSubplotNumber =\n      Number(\n        subplots[layoutAttr][subplots[layoutAttr].length - 1].split(\n          SUBPLOT_TO_ATTR[layoutAttr].layout\n        )[1]\n      ) || 1;\n\n    updateContainer({\n      [attr]: SUBPLOT_TO_ATTR[layoutAttr].layout + (lastSubplotNumber + 1),\n    });\n  }\n\n  updateSubplot(update) {\n    const currentSubplotId = this.props.fullContainer[SUBPLOT_TO_ATTR[this.props.layoutAttr].data];\n    let subplotToBeGarbageCollected = null;\n\n    // When we select another subplot, make sure no unused axes are left\n    if (\n      currentSubplotId !== update &&\n      !this.context.fullData.some(\n        trace =>\n          trace[SUBPLOT_TO_ATTR[this.props.layoutAttr].data] === currentSubplotId &&\n          trace.index !== this.props.fullContainer.index\n      )\n    ) {\n      subplotToBeGarbageCollected = currentSubplotId;\n    }\n\n    this.context.onUpdate({\n      type: EDITOR_ACTIONS.UPDATE_TRACES,\n      payload: {\n        subplotToBeGarbageCollected,\n        update: {[this.props.attr]: update},\n        traceIndexes: [this.props.fullContainer.index],\n      },\n    });\n  }\n\n  render() {\n    const icon = <PlusIcon />;\n    const extraComponent = this.canAddSubplot() ? (\n      <Button variant=\"no-text\" icon={icon} onClick={() => this.addAndUpdateSubplot()} />\n    ) : (\n      <Button variant=\"no-text--disabled\" icon={icon} onClick={() => {}} />\n    );\n\n    return (\n      <Dropdown\n        label={this.props.label}\n        attr={this.props.attr}\n        clearable={false}\n        options={this.props.options}\n        updatePlot={u => this.updateSubplot(u)}\n        extraComponent={extraComponent}\n      />\n    );\n  }\n}\n\nUnconnectedSingleSubplotCreator.propTypes = {\n  attr: PropTypes.string,\n  layoutAttr: PropTypes.string,\n  label: PropTypes.string,\n  options: PropTypes.array,\n  container: PropTypes.object,\n  fullContainer: PropTypes.object,\n  updateContainer: PropTypes.func,\n};\n\nUnconnectedSingleSubplotCreator.contextType = EditorControlsContext;\n\nconst SingleSubplotCreator = connectToContainer(UnconnectedSingleSubplotCreator);\n\nclass UnconnectedSubplotCreator extends Component {\n  render() {\n    const subplotType = traceTypeToAxisType(this.props.container.type);\n    if (!['geo', 'mapbox', 'polar', 'gl3d', 'ternary'].some(t => t === subplotType)) {\n      return null;\n    }\n\n    const isFirstTraceOfAxisType =\n      this.context.data.filter(d => traceTypeToAxisType(d.type) === subplotType).length === 1;\n    if (isFirstTraceOfAxisType) {\n      return null;\n    }\n\n    const {fullLayout, localize: _} = this.context;\n\n    function getOptions(subplotType) {\n      return fullLayout._subplots[subplotType].map(subplotId => ({\n        label: getSubplotTitle(subplotId, subplotType, _),\n        value: subplotId,\n      }));\n    }\n\n    return (\n      <PlotlySection name={_('Subplots to Use')}>\n        <SingleSubplotCreator\n          attr={SUBPLOT_TO_ATTR[subplotType].data}\n          layoutAttr={subplotType}\n          label={SUBPLOT_TO_ATTR[subplotType].layout}\n          options={getOptions(subplotType)}\n        />\n        <ModalProviderContext>\n          {({setPanel}) => (\n            <Info>\n              {_('You can style and position your subplots in the ')}\n              <a onClick={() => setPanel('Structure', 'Subplots')}>{_('Subplots')}</a>\n              {_(' panel.')}\n            </Info>\n          )}\n        </ModalProviderContext>\n      </PlotlySection>\n    );\n  }\n}\n\nUnconnectedSubplotCreator.propTypes = {\n  container: PropTypes.object,\n  fullContainer: PropTypes.object,\n};\n\nUnconnectedSubplotCreator.contextType = EditorControlsContext;\n\nexport default connectToContainer(UnconnectedSubplotCreator, {\n  modifyPlotProps: (props, context, plotProps) => {\n    const {data} = context;\n    const {fullContainer} = plotProps;\n\n    plotProps.isVisible =\n      data.length > 1 &&\n      data[fullContainer.index] &&\n      ['geo', 'mapbox', 'polar', 'gl3d', 'ternary'].some(\n        t => t === traceTypeToAxisType(data[fullContainer.index].type)\n      );\n  },\n});\n"]}